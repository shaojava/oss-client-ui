"use strict";!function(window){function isOSSClient(){var sync=navigator.userAgent.split(";")[0]||"";return"gk_sync"==sync.toLowerCase()}function getCanonicalizedOssHeaders(headers){var tmp_headers={},canonicalized_oss_headers="";for(var k in headers)0===k.toLowerCase().indexOf("x-oss-",0)&&(tmp_headers[k.toLowerCase()]=headers[k]);if(tmp_headers!={}){var x_header_list=[];for(var k in tmp_headers)x_header_list.push(k);x_header_list.sort();for(var k in x_header_list)canonicalized_oss_headers+=x_header_list[k]+":"+tmp_headers[x_header_list[k]]+"\n"}return canonicalized_oss_headers}var accessId="fmVEoAkpUByBS1cs",accessSecret="HWsJ79uEwsrh7PB6ASGpyrdZkwJWdR",OSSClient={getAccessID:function(){return JSON.stringify(accessId)},getSignature:function(param){var parseParam=JSON.parse(param),arr=[parseParam.verb,parseParam.content_md5,parseParam.content_type,parseParam.expires],canonicalizedOSSheaders="";parseParam.canonicalized_oss_headers&&(canonicalizedOSSheaders=getCanonicalizedOssHeaders(parseParam.canonicalized_oss_headers));var canonicalizedResource=parseParam.canonicalized_resource;return JSON.stringify(CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA1(arr.join("\n")+"\n"+canonicalizedOSSheaders+canonicalizedResource,accessSecret)))},getUpload:function(){return JSON.stringify({download:0,upload:0,count:1,list:[{bucket:"121212121212",object:"PhpStorm-8.0.dmg",fullpath:"C:\\Users\\george\\Desktop\\PhpStorm-8.0.dmg",offset:1e8,filesize:137181104,status:5,speed:1e4,errormsg:""},{bucket:"121212121212",object:"PhpStorm-8.0.dmg",fullpath:"C:\\Users\\george\\Desktop\\PhpStorm-8.0.dmg",offset:0,filesize:137181104,status:5,speed:0,errormsg:""}]})},getDownload:function(){}};isOSSClient()||(window.OSSClient=OSSClient)}(window),window.debug=!0;var OSS={invoke:function(name,param,callback,log){if(log!==!1&&this.log(name,arguments),"undefined"==typeof OSSClient)throw new Error("Can not find OSSClient");if("function"!=typeof OSSClient[name])throw new Error("Can not find interface "+name);var args=[JSON.stringify(param)];"function"==typeof callback&&args.push(function(re){re=re?JSON.parse(re):"",log!==!1&&this.log(name+":callback",re),callback(re)});var re=OSSClient[name].apply(this,args);return log!==!1&&this.log(name+":return",re),re=re?JSON.parse(re):""},log:function(name,info){window.debug&&console.log("%c"+name,"color:blue",info)},getUserAgent:function(){return navigator.userAgent.split(";")},getClientOS:function(){var os=this.getUserAgent()[2]||"";return os.toLowerCase()},isWindowsClient:function(){return"windows"==this.getClientOS()},isMacClient:function(){return"mac"==this.getClientOS()},isClientOS:function(){return this.isWindowsClient()||this.isMacClient()},isOSSClient:function(){var sync=this.getUserAgent()[0]||"";return"gk_sync"==sync.toLowerCase()}};angular.module("OSSCommon",[]).factory("OSSRegion",[function(){return{list:function(){return{"oss-cn-hangzhou-a":"杭州","oss-cn-qingdao-a":"青岛","oss-cn-beijing-a":"北京","oss-cn-hongkong-a":"香港","oss-cn-shenzhen-a":"深圳"}}}}]).factory("OSSException",[function(){return{getError:function(res,status){var resError=res.Error,error={status:status,code:resError.Code||"",msg:resError.Message||""};return error},getClientErrorMsg:function(res){return res.message}}}]).factory("Clipboard",function(){var maxLen=1,container=[];return{clear:function(){container=[]},len:function(){return container.length},get:function(){var item=container.shift();return OSS.log("Clipboard.get",item),item},add:function(data){container.push(data),container.length>maxLen&&container.shift(),OSS.log("Clipboard.add",data)}}}).directive("scrollLoad",["$rootScope","$parse",function($rootScope,$parse){return{restrict:"A",link:function($scope,$element,attrs){var triggerDistance=0,disableScroll=!1;null!=attrs.triggerDistance&&$scope.$watch(attrs.triggerDistance,function(value){return triggerDistance=parseInt(value||0,10)}),null!=attrs.disableScroll&&$scope.$watch(attrs.disableScroll,function(value){return disableScroll=!!value});var direction="down";attrs.triggerDirection&&(direction=attrs.triggerDirection);var startScrollTop=0,fn=$parse(attrs.scrollLoad);$element.on("scroll.scrollLoad",function(event){var _self=jQuery(this),realDistance=0,scrollH=0,scrollT=0,isScrollDown=!1;scrollH=jQuery.isWindow(this)?document.body.scrollHeight:$element[0].scrollHeight,scrollT=_self.scrollTop(),isScrollDown=scrollT>startScrollTop;var clientHeight=jQuery.isWindow(this)?document.documentElement.clientHeight||document.body.clientHeight:this.clientHeight;realDistance="down"==direction?scrollH-scrollT-clientHeight:scrollT,triggerDistance>=realDistance&&!disableScroll&&(!isScrollDown&&"up"==direction||isScrollDown&&"down"==direction)&&$scope.$apply(function(){fn($scope,{$event:event})}),startScrollTop=scrollT}),$scope.$on("$destroy",function(){$element.off("scroll.scrollLoad")})}}}]),angular.module("OSSLogin",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","angularSpinner","OSSCommon"]).controller("MainCtrl",["$scope","OSSException","OSSRegion",function($scope,OSSException,OSSRegion){$scope.step="loginById",$scope.deviceCode=OSS.invoke("getDeviceEncoding");var regions=[];angular.forEach(OSSRegion.list(),function(val,key){regions.push({name:val,value:key})}),$scope.region={name:"选择区域",value:""},regions.unshift($scope.region),$scope.regions=regions,$scope.login=function(accessKeyId,accessKeySecret,isCloudHost,region){return accessKeyId&&accessKeyId.length?accessKeySecret&&accessKeySecret.length?isCloudHost&&!region.value?void alert("请选择区域"):void OSS.invoke("loginByKey",{keyid:accessKeyId,keysecret:accessKeySecret,ishost:isCloudHost,location:region.value},function(res){res.error?alert(OSSException.getClientErrorMsg(res)):$scope.$apply(function(){$scope.step="setPassword"})}):void alert("请输入 Access Key Secret"):void alert("请输入 Access Key ID")},$scope.setPassword=function(password,rePassword){return password&&password.length?rePassword&&rePassword.length?password!==rePassword?void alert("两次输入的密码不一致"):void OSS.invoke("setPassword",{password:password},function(res){res.error?alert(OSSException.getClientErrorMsg(res)):(OSS.invoke("showLaunchpad"),OSS.invoke("closeWnd"))}):void alert("请确认安全密码"):void alert("请输入安全密码")},$scope.skipSetPassword=function(){OSS.invoke("showLaunchpad"),OSS.invoke("closeWnd")},$scope.copy=function(deviceCode){OSS.invoke("setClipboardData",{text:deviceCode}),alert("复制成功")},$scope.import=function(){}}]);